对于第 $i$ 个数 $（i\le k）$。在 $k$ 步之前，被选中的概率为 1。当走到第 k+1 步时，**被 k+1k+1\*k\*+1 个元素替换的概率 = 第k+1k+1\*k\*+1 个元素被选中的概率 \* ii\*i\* 被选中替换的概率**，即为 kk+1×1k=1k+1\frac{k}{k + 1} \times \frac{1}{k} = \frac{1}{k + 1}*k*+1*k*×*k*1=*k*+11。则不被第k+1k+1*k*+1个元素替换的概率为1−1k+1=kk+11 - \frac{1}{k + 1} = \frac{k}{k + 1}1−*k*+11=*k*+1*k*。依次类推，不被 k+2k+2*k*+2 个元素替换的概率为 1−kk+2×1k=k+1k+21 - \frac{k}{k + 2} \times \frac{1}{k} = \frac{k + 1}{k + 2}1−*k*+2*k*×*k*1=*k*+2*k*+1。则运行到第 nn*n* 步时，第 ii*i* 个数**仍保留的概率 = 被选中的概率 \* 不被替换的概率**，即：
1×kk+1×k+1k+2×k+2k+3×…×n−1n=kn1 \times \frac{k}{k + 1} \times \frac{k + 1}{k + 2} \times \frac{k + 2}{k + 3} \times … \times \frac{n - 1}{n} = \frac{k}{n}1×*k*+1*k*×*k*+2*k*+1×*k*+3*k*+2×…×*n**n*−1=*n**k*

对于第 jj*j* 个数（j>kj&gt;k*j*>*k*）。我们知道，在第 jj*j* 步被选中的概率为 kj\frac{k}{j}*j**k*。不被 j+1j+1*j*+1 个元素替换的概率为1−kj+1×1k=jj+11 - \frac{k}{j + 1} \times \frac{1}{k} = \frac{j}{j + 1}1−*j*+1*k*×*k*1=*j*+1*j*。则运行到第 nn*n* 步时，**被保留的概率 = 被选中的概率 \* 不被替换的概率**，即：
kj×jj+1×j+1j+2×j+2j+3×...×n−1n=kn\frac{k}{j} \times \frac{j}{j + 1} \times \frac{j + 1}{j + 2} \times \frac{j + 2}{j + 3} \times ... \times \frac{n - 1}{n} = \frac{k}{n}*j**k*​×*j*+1*j*​×*j*+2*j*+1​×*j*+3*j*+2​×...×*n**n*−1​=*n**k*​

所以对于其中每个元素，被保留的概率都为kn\frac{k}{n}*n**k*.

## 分布式

m/N的概率验证如下：

1. 第k台机器中的蓄水池数据被选取的概率为m/Nk。
2. 从第k台机器的蓄水池中选取一个数据放进最终蓄水池的概率为Nk/N。
3. 第k台机器蓄水池的一个数据被选中的概率为1/m。（不放回选取时等概率的）
4. 重复m次选取，则每个数据被选中的概率为**m\*(m/Nk\*Nk/N\*1/m)=m/N**。



